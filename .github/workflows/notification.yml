name: Pull Request Notifications

on:
  pull_request:
    types: [opened, reopened, ready_for_review, closed]

jobs:
  notify:
    runs-on: ubuntu-latest
    steps:
      - name: Send notification on PR Opened or Ready for Review
        if: github.event.pull_request.draft == false && (github.event.action == 'opened' || github.event.action == 'reopened' || github.event.action == 'ready_for_review')
        run: |
          curl -X POST -H "Content-Type: application/json" \
          -d '{
            "embeds": [
              {
                "title": "PR Ready for Review: ${{ github.event.pull_request.title }}",
                "description": "**${{ github.event.pull_request.user.login }}** opened a new pull request.",
                "url": "${{ github.event.pull_request.html_url }}",
                "color": 3447003,
                "author": {
                  "name": "${{ github.event.pull_request.user.login }}",
                  "url": "${{ github.event.pull_request.user.html_url }}",
                  "icon_url": "${{ github.event.pull_request.user.avatar_url }}"
                },
                "fields": [
                  {
                    "name": "Branch",
                    "value": "`${{ github.event.pull_request.head.ref }}` -> `${{ github.event.pull_request.base.ref }}`",
                    "inline": false
                  }
                ]
              }
            ],
            "components": [
              {
                "type": 1,
                "components": [
                  {
                    "type": 2,
                    "label": "View Pull Request",
                    "style": 5,
                    "url": "${{ github.event.pull_request.html_url }}"
                  }
                ]
              }
            ]
          }' \
          "${{ secrets.DISCORD_WEBHOOK_URL }}?with_components=true"

      - name: Send notification on PR Merged
        if: github.event.action == 'closed' && github.event.pull_request.merged == true
        run: |
          curl -X POST -H "Content-Type: application/json" \
          -d '{
            "embeds": [
              {
                "title": "PR Merged: ${{ github.event.pull_request.title }}",
                "description": "The pull request was merged by **${{ github.event.pull_request.merged_by.login }}**.",
                "url": "${{ github.event.pull_request.html_url }}",
                "color": 3066993,
                "author": {
                  "name": "${{ github.event.pull_request.user.login }}",
                  "url": "${{ github.event.pull_request.user.html_url }}",
                  "icon_url": "${{ github.event.pull_request.user.avatar_url }}"
                }
              }
            ],
            "components": [
              {
                "type": 1,
                "components": [
                  {
                    "type": 2,
                    "label": "View Merged PR",
                    "style": 5,
                    "url": "${{ github.event.pull_request.html_url }}"
                  }
                ]
              }
            ]
          }' \
          "${{ secrets.DISCORD_WEBHOOK_URL }}?with_components=true"

      - name: Send notification on PR Closed
        if: github.event.action == 'closed' && github.event.pull_request.merged == false
        run: |
          curl -X POST -H "Content-Type: application/json" \
          -d '{
            "embeds": [
              {
                "title": "PR Closed: ${{ github.event.pull_request.title }}",
                "description": "The pull request was closed without merging.",
                "url": "${{ github.event.pull_request.html_url }}",
                "color": 15158332,
                "author": {
                  "name": "${{ github.event.pull_request.user.login }}",
                  "url": "${{ github.event.pull_request.user.html_url }}",
                  "icon_url": "${{ github.event.pull_request.user.avatar_url }}"
                }
              }
            ],
            "components": [
              {
                "type": 1,
                "components": [
                  {
                    "type": 2,
                    "label": "View Closed PR",
                    "style": 5,
                    "url": "${{ github.event.pull_request.html_url }}"
                  }
                ]
              }
            ]
          }' \
          "${{ secrets.DISCORD_WEBHOOK_URL }}?with_components=true"
